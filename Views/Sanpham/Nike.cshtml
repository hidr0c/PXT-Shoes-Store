@using VinaShoseShop.Models
@model List<Sanpham>

@section Styles {
    <link href="@Url.Content("~/Scripts/CSS/NikeStyles.css")" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" type="text/css" />
}

<section class="nike-section">
    <div class="container">
        <div class="brand-container">
            <div class="brand-title">Nike</div>
        </div>

        <div class="products-container">
            @foreach (var item in Model)
            {
                <div class="product-card">
                    <div class="product-image">
                        @if (item.Sale == true)
                        {
                            decimal gia = Convert.ToDecimal(item.Giatien);
                            decimal giaSale = Convert.ToDecimal(item.GiaSale);
                            decimal phanTramGiamGia = gia != 0 ? ((gia - giaSale) / gia) * 100 : 0;
                            int giamgia = Convert.ToInt32(phanTramGiamGia);
                            <div class="sale-badge">
                                -@giamgia%
                            </div>
                        }
                        <a href="@Url.Action("xemchitiet", "Sanpham", new { @Masp = item.Masp })">
                            <img src="@Url.Content("~/HinhanhSP/" + item.Anhbia)" class="img-responsive" alt="@item.Tensp" />
                        </a>
                    </div>
                    <div class="product-details">
                        <h3>@item.Tensp</h3>
                        @if (item.Sale == true)
                        {
                            <div class="price">
                                <span class="sale-price">@item.GiaSale đ</span>
                                <del class="original-price">@item.Giatien đ</del>
                            </div>
                        }
                        else
                        {
                            <div class="price">
                                <span class="regular-price">@item.Giatien đ</span>
                            </div>
                        }
                        @using (Html.BeginForm("ThemGioHang", "GioHang", new { @iMasp = item.Masp, @strURL = Request.Url.ToString() }, FormMethod.Post, new { @id = "form-" + item.Masp, @class = "add-to-cart-form" }))
                        {
                            <label for="size-@item.Masp">Chọn size:</label>
                            <select name="size" id="size-@item.Masp" required>
                                <option value="">Chọn size</option>
                                <option value="36">36</option>
                                <option value="37">37</option>
                                <option value="38">38</option>
                                <option value="39">39</option>
                                <option value="40">40</option>
                                <option value="41">41</option>
                                <option value="42">42</option>
                                <option value="43">43</option>
                                <option value="44">44</option>
                                <option value="45">45</option>
                            </select>
                            <input type="number" name="quantity" value="1" min="1" required>
                            <input type="submit" value="Thêm vào giỏ" class="btn btn-primary btn-add-to-cart" data-product-name="@item.Tensp" />
                        }
                    </div>
                </div>
            }
        </div>

        <div class="cart-notification" id="cart-notification">
            Sản phẩm đã được thêm vào giỏ hàng!
        </div>
    </div>
</section>

@section Scripts {
    <script>
        // Hàm thêm sản phẩm vào giỏ hàng
        function addToCart(productName) {
            const cartNotification = document.getElementById('cart-notification');
            cartNotification.style.display = 'block';
            setTimeout(() => {
                cartNotification.style.display = 'none';
            }, 3000);
        }

        // Gắn sự kiện cho các form "Thêm vào giỏ hàng"
        document.querySelectorAll('.add-to-cart-form').forEach(form => {
            form.addEventListener('submit', function (e) {
                const productName = this.querySelector('input[type="submit"]').getAttribute('data-product-name');
                addToCart(productName);
            });
        });
    </script>
}